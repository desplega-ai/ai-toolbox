# Hive v0.1 - Foundation Setup Implementation Plan

## Overview

Set up the foundational Electron app for Hive - a macOS desktop application for managing Claude Code sessions. This phase establishes the project structure, storage system, theming, and core UX scaffolding while leaving placeholders for Claude SDK integration and the Thoughts pane.

## Current State Analysis

- **No existing Hive project**: The `hive/` directory was deleted (visible in git status)
- **Research complete**: Five comprehensive research documents define the architecture:
  - `2025-12-15-hive-electron-app-research.md` - Core architecture decisions
  - `2025-12-15-hive-electron-forge-setup.md` - Project setup details
  - `2025-12-15-hive-claude-sdk-integration.md` - SDK patterns (deferred)
  - `2025-12-15-hive-storage-and-remote-access.md` - Storage architecture
  - `2025-12-15-hive-ux-ui-design-spec.md` - Complete UX/UI specification

### Key Discoveries:
- Electron Forge + Vite + pnpm is the chosen stack (research: `2025-12-15-hive-electron-forge-setup.md`)
- Storage at `~/.hive/` using SQLite (`better-sqlite3`) + electron-store (research: `2025-12-15-hive-storage-and-remote-access.md:46-118`)
- Solarized theme with shadcn/ui components (research: `2025-12-15-hive-ux-ui-design-spec.md:474-571`)
- Terminal-style top bar with browser tabs (research: `2025-12-15-hive-ux-ui-design-spec.md:766-858`)

## Desired End State

After completing this plan:

1. **Running Electron app** with `pnpm start` that shows the main window
2. **SQLite database** at `~/.hive/hive.db` with schema for projects, sessions, worktrees
3. **Preferences store** at `~/.hive/preferences.json` with electron-store
4. **Solarized theme** (light/dark) with shadcn/ui components and Tailwind CSS
5. **Core layout** with:
   - Terminal-style top bar with tabs
   - Collapsible sidebar
   - Resizable panels (react-resizable-panels)
6. **Placeholder views**:
   - Start View (project cards grid)
   - Project View (sidebar + main panel)
   - Session View (Agent tab placeholder)
   - Settings modal (theme toggle working)

### Verification:
- `pnpm start` launches the app with no errors
- Theme toggle switches between Solarized Light/Dark
- Sidebar collapses/expands with state persistence
- Panel resize state persists across restarts
- Database file exists at `~/.hive/hive.db`

## What We're NOT Doing

1. **Claude SDK integration** - Placeholder only, no actual API calls
2. **Thoughts pane** - Placeholder component, no file tree or Monaco editor
3. **Analytics page** - Not implemented in v0.1
4. **Remote access / localtunnel** - Deferred to later phase
5. **System tray** - Deferred (close = close, not minimize)
6. **Diff tab** - Placeholder only
7. **Native notifications** - Deferred until SDK integration
8. **Session creation modal** - Basic placeholder only

## Implementation Approach

Build incrementally from the ground up:
1. Scaffold the Electron project with proper TypeScript config
2. Add all dependencies before writing application code
3. Set up storage layer (database must exist before UI references it)
4. Configure theming system (needed for all UI components)
5. Build layout components top-down (TopBar → Sidebar → Panels)
6. Add placeholder views that demonstrate the layout works

---

## Phase 1: Project Scaffolding

### Overview
Create the Electron Forge + Vite + TypeScript project with pnpm.

### Changes Required:

#### 1. Create Project
**Location**: `/Users/taras/Documents/code/ai-toolbox/hive/`

```bash
cd /Users/taras/Documents/code/ai-toolbox
pnpm dlx create-electron-app@latest hive --template=vite-typescript
cd hive
```

#### 2. Verify Project Structure
After creation, the structure should be:

```
hive/
├── src/
│   ├── main.ts
│   ├── preload.ts
│   └── renderer.ts
├── index.html
├── forge.config.ts
├── vite.main.config.mjs
├── vite.preload.config.mjs
├── vite.renderer.config.mjs
├── tsconfig.json
├── package.json
└── pnpm-lock.yaml
```

#### 3. Update package.json
**File**: `hive/package.json`

Update the name and productName:

```json
{
  "name": "hive",
  "productName": "Hive",
  "version": "0.1.0",
  "description": "macOS app for managing Claude Code sessions"
}
```

### Success Criteria:

#### Automated Verification:
- [x] Directory exists: `ls -la /Users/taras/Documents/code/ai-toolbox/hive`
- [x] Project runs: `cd hive && pnpm start` (opens Electron window)
- [x] TypeScript compiles: `cd hive && pnpm exec tsc --noEmit`

#### Manual Verification:
- [x] Electron window opens with default "Hello World" content
- [x] DevTools can be opened with Cmd+Option+I

**Implementation Note**: After completing this phase and all automated verification passes, pause here for manual confirmation before proceeding to Phase 2.

---

## Phase 2: Dependencies & Configuration

### Overview
Install all required packages and configure Vite/TypeScript for the project structure.

### Changes Required:

#### 1. Install Dependencies
**Location**: `hive/`

```bash
cd /Users/taras/Documents/code/ai-toolbox/hive

# React and types
pnpm add react react-dom
pnpm add -D @types/react @types/react-dom @vitejs/plugin-react

# UI framework
pnpm add tailwindcss postcss autoprefixer
pnpm add class-variance-authority clsx tailwind-merge
pnpm add lucide-react

# State management
pnpm add zustand

# Layout
pnpm add react-resizable-panels

# Storage
pnpm add better-sqlite3 electron-store
pnpm add -D @types/better-sqlite3

# Electron utilities
pnpm add electron-window-state
pnpm add -D @electron/rebuild

# Fonts
pnpm add @fontsource/hack
```

#### 2. Initialize Tailwind CSS
**File**: `hive/tailwind.config.js`

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: 'class',
  content: [
    './index.html',
    './src/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        // Solarized base colors
        'sol-base03': '#002b36',
        'sol-base02': '#073642',
        'sol-base01': '#586e75',
        'sol-base00': '#657b83',
        'sol-base0': '#839496',
        'sol-base1': '#93a1a1',
        'sol-base2': '#eee8d5',
        'sol-base3': '#fdf6e3',
        // Solarized accent colors
        'sol-yellow': '#b58900',
        'sol-orange': '#cb4b16',
        'sol-red': '#dc322f',
        'sol-magenta': '#d33682',
        'sol-violet': '#6c71c4',
        'sol-blue': '#268bd2',
        'sol-cyan': '#2aa198',
        'sol-green': '#859900',
      },
      fontFamily: {
        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
        mono: ['Hack', 'Fira Code', 'SF Mono', 'Monaco', 'Consolas', 'monospace'],
      },
    },
  },
  plugins: [],
};
```

#### 3. Create PostCSS Config
**File**: `hive/postcss.config.js`

```javascript
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
```

#### 4. Update tsconfig.json
**File**: `hive/tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/renderer/*"],
      "@shared/*": ["./src/shared/*"],
      "@main/*": ["./src/main/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.tsx", "src/**/*.d.ts"]
}
```

#### 5. Update Vite Renderer Config
**File**: `hive/vite.renderer.config.mjs`

```javascript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src/renderer'),
      '@shared': path.resolve(__dirname, 'src/shared'),
    },
  },
  css: {
    postcss: './postcss.config.js',
  },
});
```

#### 6. Update Vite Main Config
**File**: `hive/vite.main.config.mjs`

```javascript
import { defineConfig } from 'vite';
import path from 'path';

export default defineConfig({
  resolve: {
    alias: {
      '@shared': path.resolve(__dirname, 'src/shared'),
      '@main': path.resolve(__dirname, 'src/main'),
    },
  },
  build: {
    rollupOptions: {
      external: [
        'electron',
        'better-sqlite3',
        'electron-store',
        'electron-window-state',
      ],
    },
  },
});
```

#### 7. Create Directory Structure
Create the following directories:

```
hive/src/
├── main/
│   ├── index.ts          # Main process entry (move from src/main.ts)
│   ├── database.ts       # SQLite setup
│   ├── preferences.ts    # electron-store setup
│   └── ipc-handlers.ts   # IPC handler registration
├── preload/
│   └── index.ts          # Preload script (move from src/preload.ts)
├── renderer/
│   ├── index.tsx         # React entry
│   ├── App.tsx           # Root component
│   ├── index.css         # Global styles + Tailwind
│   ├── components/
│   │   ├── ui/           # shadcn-style components
│   │   ├── layout/       # TopBar, Sidebar, etc.
│   │   └── views/        # Start, Project, Session views
│   ├── hooks/
│   ├── lib/
│   │   ├── utils.ts      # cn() helper
│   │   └── store.ts      # Zustand stores
│   └── styles/
│       └── solarized.css # Theme CSS custom properties
└── shared/
    └── types.ts          # Shared TypeScript types
```

#### 8. Update forge.config.ts Entry Points
**File**: `hive/forge.config.ts`

Update the VitePlugin configuration to use new paths:

```typescript
import type { ForgeConfig } from '@electron-forge/shared-types';
import { MakerZIP } from '@electron-forge/maker-zip';
import { MakerDMG } from '@electron-forge/maker-dmg';
import { VitePlugin } from '@electron-forge/plugin-vite';

const config: ForgeConfig = {
  packagerConfig: {
    asar: true,
    icon: './resources/icon',
    appBundleId: 'ai.desplega.hive',
    appCategoryType: 'public.app-category.developer-tools',
  },
  rebuildConfig: {},
  makers: [
    new MakerZIP({}, ['darwin']),
    new MakerDMG({
      format: 'ULFO',
    }),
  ],
  plugins: [
    new VitePlugin({
      build: [
        {
          entry: 'src/main/index.ts',
          config: 'vite.main.config.mjs',
          target: 'main',
        },
        {
          entry: 'src/preload/index.ts',
          config: 'vite.preload.config.mjs',
          target: 'preload',
        },
      ],
      renderer: [
        {
          name: 'main_window',
          config: 'vite.renderer.config.mjs',
        },
      ],
    }),
  ],
};

export default config;
```

#### 9. Update index.html
**File**: `hive/index.html`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hive</title>
  </head>
  <body class="bg-sol-base3 dark:bg-sol-base03 text-sol-base00 dark:text-sol-base0">
    <div id="root"></div>
    <script type="module" src="/src/renderer/index.tsx"></script>
  </body>
</html>
```

### Success Criteria:

#### Automated Verification:
- [x] All dependencies installed: `cd hive && pnpm install` (no errors)
- [x] TypeScript compiles: `cd hive && pnpm exec tsc --noEmit`
- [x] Native modules rebuilt: `cd hive && pnpm exec electron-rebuild`

#### Manual Verification:
- [x] Directory structure matches specification
- [x] `pnpm start` still works (may show errors until Phase 3 files are created)

**Implementation Note**: After completing this phase and all automated verification passes, pause here for manual confirmation before proceeding to Phase 3.

---

## Phase 3: Storage Layer

### Overview
Implement SQLite database at `~/.hive/` and electron-store for preferences.

### Changes Required:

#### 1. Shared Types
**File**: `hive/src/shared/types.ts`

```typescript
// Project and session types
export interface Project {
  id: string;
  name: string;
  directory: string;
  settings: Record<string, unknown>;
  createdAt: number;
  updatedAt: number;
}

export interface Session {
  id: string;
  projectId: string;
  claudeSessionId: string | null;
  name: string;
  actionType: 'research' | 'plan' | 'implement' | 'freeform';
  status: 'idle' | 'running' | 'awaiting_input' | 'error';
  metadata: Record<string, unknown>;
  createdAt: number;
  updatedAt: number;
}

export interface Worktree {
  id: string;
  projectId: string;
  path: string;
  branch: string;
  description: string | null;
  createdAt: number;
}

// Preferences types
export interface Preferences {
  theme: 'light' | 'dark' | 'system';
  defaultModel: string;
  defaultActionType: Session['actionType'];
  recentDirectories: string[];
  notifications: {
    inputRequired: boolean;
    sessionComplete: boolean;
  };
}

// IPC types
export interface IpcChannels {
  'db:projects:list': { params: void; result: Project[] };
  'db:projects:create': { params: Omit<Project, 'id' | 'createdAt' | 'updatedAt'>; result: Project };
  'db:projects:delete': { params: { id: string }; result: void };
  'db:sessions:list': { params: { projectId: string }; result: Session[] };
  'db:sessions:create': { params: Omit<Session, 'id' | 'createdAt' | 'updatedAt'>; result: Session };
  'preferences:get': { params: void; result: Preferences };
  'preferences:set': { params: Partial<Preferences>; result: void };
  'dialog:open-directory': { params: void; result: string | null };
}
```

#### 2. Database Module
**File**: `hive/src/main/database.ts`

```typescript
import Database from 'better-sqlite3';
import { app } from 'electron';
import path from 'path';
import fs from 'fs';
import { nanoid } from 'nanoid';
import type { Project, Session, Worktree } from '@shared/types';

const HIVE_DIR = path.join(app.getPath('home'), '.hive');
const DB_PATH = path.join(HIVE_DIR, 'hive.db');

// Ensure directory exists
if (!fs.existsSync(HIVE_DIR)) {
  fs.mkdirSync(HIVE_DIR, { recursive: true });
}

const db = new Database(DB_PATH);

// Enable WAL mode for better concurrency
db.pragma('journal_mode = WAL');
db.pragma('synchronous = NORMAL');
db.pragma('foreign_keys = ON');

// Initialize schema
db.exec(`
  CREATE TABLE IF NOT EXISTS projects (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    directory TEXT NOT NULL UNIQUE,
    settings TEXT DEFAULT '{}',
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
  );

  CREATE TABLE IF NOT EXISTS sessions (
    id TEXT PRIMARY KEY,
    project_id TEXT NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    claude_session_id TEXT,
    name TEXT NOT NULL,
    action_type TEXT CHECK(action_type IN ('research', 'plan', 'implement', 'freeform')),
    status TEXT DEFAULT 'idle' CHECK(status IN ('idle', 'running', 'awaiting_input', 'error')),
    metadata TEXT DEFAULT '{}',
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
  );

  CREATE TABLE IF NOT EXISTS worktrees (
    id TEXT PRIMARY KEY,
    project_id TEXT NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    path TEXT NOT NULL UNIQUE,
    branch TEXT NOT NULL,
    description TEXT,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
  );

  CREATE INDEX IF NOT EXISTS idx_sessions_project ON sessions(project_id);
  CREATE INDEX IF NOT EXISTS idx_sessions_status ON sessions(status);
  CREATE INDEX IF NOT EXISTS idx_worktrees_project ON worktrees(project_id);
`);

// Prepared statements
const statements = {
  // Projects
  getAllProjects: db.prepare(`
    SELECT id, name, directory, settings, created_at as createdAt, updated_at as updatedAt
    FROM projects ORDER BY updated_at DESC
  `),
  getProjectById: db.prepare(`
    SELECT id, name, directory, settings, created_at as createdAt, updated_at as updatedAt
    FROM projects WHERE id = ?
  `),
  insertProject: db.prepare(`
    INSERT INTO projects (id, name, directory, settings)
    VALUES (?, ?, ?, ?)
  `),
  updateProject: db.prepare(`
    UPDATE projects SET name = ?, settings = ?, updated_at = ? WHERE id = ?
  `),
  deleteProject: db.prepare(`DELETE FROM projects WHERE id = ?`),

  // Sessions
  getSessionsByProject: db.prepare(`
    SELECT id, project_id as projectId, claude_session_id as claudeSessionId,
           name, action_type as actionType, status, metadata,
           created_at as createdAt, updated_at as updatedAt
    FROM sessions WHERE project_id = ? ORDER BY updated_at DESC
  `),
  insertSession: db.prepare(`
    INSERT INTO sessions (id, project_id, claude_session_id, name, action_type, status, metadata)
    VALUES (?, ?, ?, ?, ?, ?, ?)
  `),
  updateSessionStatus: db.prepare(`
    UPDATE sessions SET status = ?, updated_at = ? WHERE id = ?
  `),
  deleteSession: db.prepare(`DELETE FROM sessions WHERE id = ?`),
};

// Database API
export const database = {
  projects: {
    list(): Project[] {
      const rows = statements.getAllProjects.all() as any[];
      return rows.map(row => ({
        ...row,
        settings: JSON.parse(row.settings || '{}'),
      }));
    },

    create(data: Omit<Project, 'id' | 'createdAt' | 'updatedAt'>): Project {
      const id = nanoid();
      const now = Date.now();
      statements.insertProject.run(id, data.name, data.directory, JSON.stringify(data.settings || {}));
      return {
        id,
        ...data,
        settings: data.settings || {},
        createdAt: now,
        updatedAt: now,
      };
    },

    delete(id: string): void {
      statements.deleteProject.run(id);
    },
  },

  sessions: {
    listByProject(projectId: string): Session[] {
      const rows = statements.getSessionsByProject.all(projectId) as any[];
      return rows.map(row => ({
        ...row,
        metadata: JSON.parse(row.metadata || '{}'),
      }));
    },

    create(data: Omit<Session, 'id' | 'createdAt' | 'updatedAt'>): Session {
      const id = nanoid();
      const now = Date.now();
      statements.insertSession.run(
        id,
        data.projectId,
        data.claudeSessionId,
        data.name,
        data.actionType,
        data.status,
        JSON.stringify(data.metadata || {})
      );
      return {
        id,
        ...data,
        metadata: data.metadata || {},
        createdAt: now,
        updatedAt: now,
      };
    },

    updateStatus(id: string, status: Session['status']): void {
      statements.updateSessionStatus.run(status, Date.now(), id);
    },
  },

  close(): void {
    db.close();
  },
};

export { db };
```

#### 3. Preferences Module
**File**: `hive/src/main/preferences.ts`

```typescript
import Store from 'electron-store';
import { app } from 'electron';
import path from 'path';
import type { Preferences } from '@shared/types';

const HIVE_DIR = path.join(app.getPath('home'), '.hive');

export const preferences = new Store<Preferences>({
  name: 'preferences',
  cwd: HIVE_DIR,
  defaults: {
    theme: 'system',
    defaultModel: 'claude-sonnet-4-5',
    defaultActionType: 'freeform',
    recentDirectories: [],
    notifications: {
      inputRequired: true,
      sessionComplete: true,
    },
  },
});

export function getPreferences(): Preferences {
  return {
    theme: preferences.get('theme'),
    defaultModel: preferences.get('defaultModel'),
    defaultActionType: preferences.get('defaultActionType'),
    recentDirectories: preferences.get('recentDirectories'),
    notifications: preferences.get('notifications'),
  };
}

export function setPreferences(updates: Partial<Preferences>): void {
  for (const [key, value] of Object.entries(updates)) {
    preferences.set(key as keyof Preferences, value);
  }
}

export function addRecentDirectory(dir: string): void {
  const recent = preferences.get('recentDirectories');
  const filtered = recent.filter(d => d !== dir);
  const updated = [dir, ...filtered].slice(0, 10);
  preferences.set('recentDirectories', updated);
}
```

#### 4. IPC Handlers
**File**: `hive/src/main/ipc-handlers.ts`

```typescript
import { ipcMain, dialog, BrowserWindow } from 'electron';
import { database } from './database';
import { getPreferences, setPreferences, addRecentDirectory } from './preferences';

export function registerIpcHandlers(mainWindow: BrowserWindow): void {
  // Projects
  ipcMain.handle('db:projects:list', () => {
    return database.projects.list();
  });

  ipcMain.handle('db:projects:create', (_, data) => {
    const project = database.projects.create(data);
    addRecentDirectory(data.directory);
    return project;
  });

  ipcMain.handle('db:projects:delete', (_, { id }) => {
    database.projects.delete(id);
  });

  // Sessions
  ipcMain.handle('db:sessions:list', (_, { projectId }) => {
    return database.sessions.listByProject(projectId);
  });

  ipcMain.handle('db:sessions:create', (_, data) => {
    return database.sessions.create(data);
  });

  // Preferences
  ipcMain.handle('preferences:get', () => {
    return getPreferences();
  });

  ipcMain.handle('preferences:set', (_, updates) => {
    setPreferences(updates);
    // Notify renderer of preference changes
    mainWindow.webContents.send('preferences:changed', getPreferences());
  });

  // Dialogs
  ipcMain.handle('dialog:open-directory', async () => {
    const result = await dialog.showOpenDialog(mainWindow, {
      properties: ['openDirectory', 'createDirectory'],
    });
    return result.canceled ? null : result.filePaths[0];
  });
}
```

#### 5. Add nanoid Dependency
```bash
cd /Users/taras/Documents/code/ai-toolbox/hive
pnpm add nanoid
```

### Success Criteria:

#### Automated Verification:
- [x] TypeScript compiles: `cd hive && pnpm exec tsc --noEmit`
- [x] App starts without database errors: `cd hive && pnpm start`
- [x] Database file created: `ls ~/.hive/hive.db`
- [x] Preferences file created: `ls ~/.hive/preferences.json`

#### Manual Verification:
- [x] No errors in Electron main process console
- [x] Database has correct tables (can verify with sqlite3 CLI)

**Implementation Note**: After completing this phase and all automated verification passes, pause here for manual confirmation before proceeding to Phase 4.

---

## Phase 4: Theming System

### Overview
Set up Solarized theme with shadcn/ui patterns, Tailwind CSS, and CSS custom properties.

### Changes Required:

#### 1. Solarized CSS Variables
**File**: `hive/src/renderer/styles/solarized.css`

```css
:root {
  /* Solarized Base Colors */
  --sol-base03: 0 43 54;    /* #002b36 */
  --sol-base02: 7 54 66;    /* #073642 */
  --sol-base01: 88 110 117; /* #586e75 */
  --sol-base00: 101 123 131; /* #657b83 */
  --sol-base0: 131 148 150;  /* #839496 */
  --sol-base1: 147 161 161;  /* #93a1a1 */
  --sol-base2: 238 232 213;  /* #eee8d5 */
  --sol-base3: 253 246 227;  /* #fdf6e3 */

  /* Solarized Accent Colors */
  --sol-yellow: 181 137 0;   /* #b58900 */
  --sol-orange: 203 75 22;   /* #cb4b16 */
  --sol-red: 220 50 47;      /* #dc322f */
  --sol-magenta: 211 54 130; /* #d33682 */
  --sol-violet: 108 113 196; /* #6c71c4 */
  --sol-blue: 38 139 210;    /* #268bd2 */
  --sol-cyan: 42 161 152;    /* #2aa198 */
  --sol-green: 133 153 0;    /* #859900 */
}

/* Light Mode (default) */
:root {
  --background: var(--sol-base3);
  --background-secondary: var(--sol-base2);
  --foreground: var(--sol-base00);
  --foreground-muted: var(--sol-base1);

  --primary: var(--sol-blue);
  --primary-foreground: var(--sol-base3);

  --secondary: var(--sol-base2);
  --secondary-foreground: var(--sol-base01);

  --accent: var(--sol-cyan);
  --accent-foreground: var(--sol-base3);

  --destructive: var(--sol-red);
  --destructive-foreground: var(--sol-base3);

  --warning: var(--sol-orange);
  --success: var(--sol-green);

  --border: var(--sol-base2);
  --ring: var(--sol-blue);

  --sidebar: var(--sol-base2);
  --sidebar-foreground: var(--sol-base00);
  --sidebar-accent: var(--sol-base3);

  --radius: 0.375rem;
}

/* Dark Mode */
.dark {
  --background: var(--sol-base03);
  --background-secondary: var(--sol-base02);
  --foreground: var(--sol-base0);
  --foreground-muted: var(--sol-base01);

  --primary: var(--sol-blue);
  --primary-foreground: var(--sol-base03);

  --secondary: var(--sol-base02);
  --secondary-foreground: var(--sol-base1);

  --border: var(--sol-base02);

  --sidebar: var(--sol-base02);
  --sidebar-foreground: var(--sol-base0);
  --sidebar-accent: var(--sol-base03);
}
```

#### 2. Global CSS with Tailwind
**File**: `hive/src/renderer/index.css`

```css
@import './styles/solarized.css';
@import '@fontsource/hack/400.css';
@import '@fontsource/hack/700.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply border-[rgb(var(--border))];
  }

  body {
    @apply bg-[rgb(var(--background))] text-[rgb(var(--foreground))];
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-[rgb(var(--background-secondary))];
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-[rgb(var(--foreground-muted))] rounded;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-[rgb(var(--foreground))];
  }
}

@layer components {
  /* Draggable regions for window */
  .draggable {
    -webkit-app-region: drag;
  }

  .no-drag {
    -webkit-app-region: no-drag;
  }
}
```

#### 3. Utility Functions
**File**: `hive/src/renderer/lib/utils.ts`

```typescript
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

#### 4. Button Component (shadcn-style)
**File**: `hive/src/renderer/components/ui/button.tsx`

```tsx
import * as React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '@/lib/utils';

const buttonVariants = cva(
  'inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--ring))] disabled:pointer-events-none disabled:opacity-50',
  {
    variants: {
      variant: {
        default: 'bg-[rgb(var(--primary))] text-[rgb(var(--primary-foreground))] hover:opacity-90',
        destructive: 'bg-[rgb(var(--destructive))] text-[rgb(var(--destructive-foreground))] hover:opacity-90',
        outline: 'border border-[rgb(var(--border))] bg-transparent hover:bg-[rgb(var(--secondary))]',
        secondary: 'bg-[rgb(var(--secondary))] text-[rgb(var(--secondary-foreground))] hover:opacity-80',
        ghost: 'hover:bg-[rgb(var(--secondary))] hover:text-[rgb(var(--foreground))]',
        link: 'text-[rgb(var(--primary))] underline-offset-4 hover:underline',
      },
      size: {
        default: 'h-9 px-4 py-2',
        sm: 'h-8 rounded-md px-3 text-xs',
        lg: 'h-10 rounded-md px-8',
        icon: 'h-9 w-9',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  }
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, ...props }, ref) => {
    return (
      <button
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    );
  }
);
Button.displayName = 'Button';

export { Button, buttonVariants };
```

#### 5. Card Component
**File**: `hive/src/renderer/components/ui/card.tsx`

```tsx
import * as React from 'react';
import { cn } from '@/lib/utils';

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn(
        'rounded-lg border border-[rgb(var(--border))] bg-[rgb(var(--background))] shadow-sm',
        className
      )}
      {...props}
    />
  )
);
Card.displayName = 'Card';

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn('flex flex-col space-y-1.5 p-4', className)} {...props} />
  )
);
CardHeader.displayName = 'CardHeader';

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3
      ref={ref}
      className={cn('font-semibold leading-none tracking-tight', className)}
      {...props}
    />
  )
);
CardTitle.displayName = 'CardTitle';

const CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <p ref={ref} className={cn('text-sm text-[rgb(var(--foreground-muted))]', className)} {...props} />
  )
);
CardDescription.displayName = 'CardDescription';

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn('p-4 pt-0', className)} {...props} />
  )
);
CardContent.displayName = 'CardContent';

export { Card, CardHeader, CardTitle, CardDescription, CardContent };
```

#### 6. Theme Store
**File**: `hive/src/renderer/lib/store.ts`

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { Preferences, Project, Session } from '@shared/types';

interface ThemeState {
  theme: 'light' | 'dark' | 'system';
  resolvedTheme: 'light' | 'dark';
  setTheme: (theme: 'light' | 'dark' | 'system') => void;
}

export const useThemeStore = create<ThemeState>()(
  persist(
    (set) => ({
      theme: 'system',
      resolvedTheme: 'light',
      setTheme: (theme) => {
        const resolvedTheme =
          theme === 'system'
            ? window.matchMedia('(prefers-color-scheme: dark)').matches
              ? 'dark'
              : 'light'
            : theme;

        // Apply to document
        document.documentElement.classList.toggle('dark', resolvedTheme === 'dark');

        set({ theme, resolvedTheme });
      },
    }),
    {
      name: 'hive-theme',
    }
  )
);

// Initialize theme on load
export function initializeTheme() {
  const store = useThemeStore.getState();
  store.setTheme(store.theme);

  // Listen for system theme changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (store.theme === 'system') {
      store.setTheme('system');
    }
  });
}

// App state store
interface AppState {
  projects: Project[];
  currentProject: Project | null;
  sessions: Session[];
  currentSession: Session | null;
  setProjects: (projects: Project[]) => void;
  setCurrentProject: (project: Project | null) => void;
  setSessions: (sessions: Session[]) => void;
  setCurrentSession: (session: Session | null) => void;
}

export const useAppStore = create<AppState>((set) => ({
  projects: [],
  currentProject: null,
  sessions: [],
  currentSession: null,
  setProjects: (projects) => set({ projects }),
  setCurrentProject: (currentProject) => set({ currentProject }),
  setSessions: (sessions) => set({ sessions }),
  setCurrentSession: (currentSession) => set({ currentSession }),
}));
```

### Success Criteria:

#### Automated Verification:
- [x] TypeScript compiles: `cd hive && pnpm exec tsc --noEmit`
- [x] CSS builds without errors: `cd hive && pnpm start`

#### Manual Verification:
- [x] App shows with Solarized Light theme by default
- [x] Theme can be toggled to dark mode (will verify in Phase 5)
- [x] Fonts render correctly (Geist for sans/mono)

**Implementation Note**: After completing this phase and all automated verification passes, pause here for manual confirmation before proceeding to Phase 5.

---

## Phase 5: Core Layout & UX

### Overview
Implement the main layout with TopBar, collapsible sidebar, and resizable panels.

### Changes Required:

#### 1. Main Process Entry
**File**: `hive/src/main/index.ts`

```typescript
import { app, BrowserWindow } from 'electron';
import path from 'path';
import windowStateKeeper from 'electron-window-state';
import { registerIpcHandlers } from './ipc-handlers';
import { database } from './database';

declare const MAIN_WINDOW_VITE_DEV_SERVER_URL: string;
declare const MAIN_WINDOW_VITE_NAME: string;

let mainWindow: BrowserWindow | null = null;

function createWindow(): void {
  const mainWindowState = windowStateKeeper({
    defaultWidth: 1400,
    defaultHeight: 900,
  });

  mainWindow = new BrowserWindow({
    x: mainWindowState.x,
    y: mainWindowState.y,
    width: mainWindowState.width,
    height: mainWindowState.height,
    show: false,
    minWidth: 800,
    minHeight: 600,

    // macOS-specific
    titleBarStyle: 'hiddenInset',
    trafficLightPosition: { x: 15, y: 10 },
    vibrancy: 'sidebar',

    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      sandbox: true,
      preload: path.join(__dirname, 'preload.js'),
    },
  });

  mainWindowState.manage(mainWindow);

  mainWindow.once('ready-to-show', () => {
    mainWindow?.show();
  });

  // Register IPC handlers
  registerIpcHandlers(mainWindow);

  // Load app
  if (MAIN_WINDOW_VITE_DEV_SERVER_URL) {
    mainWindow.loadURL(MAIN_WINDOW_VITE_DEV_SERVER_URL);
  } else {
    mainWindow.loadFile(
      path.join(__dirname, `../renderer/${MAIN_WINDOW_VITE_NAME}/index.html`)
    );
  }
}

app.whenReady().then(createWindow);

app.on('window-all-closed', () => {
  database.close();
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createWindow();
  }
});
```

#### 2. Preload Script
**File**: `hive/src/preload/index.ts`

```typescript
import { contextBridge, ipcRenderer } from 'electron';

export interface ElectronAPI {
  invoke: <T>(channel: string, ...args: unknown[]) => Promise<T>;
  on: (channel: string, callback: (...args: unknown[]) => void) => () => void;
}

contextBridge.exposeInMainWorld('electronAPI', {
  invoke: <T>(channel: string, ...args: unknown[]): Promise<T> => {
    return ipcRenderer.invoke(channel, ...args);
  },
  on: (channel: string, callback: (...args: unknown[]) => void) => {
    const subscription = (_event: Electron.IpcRendererEvent, ...args: unknown[]) =>
      callback(...args);
    ipcRenderer.on(channel, subscription);
    return () => ipcRenderer.removeListener(channel, subscription);
  },
});
```

#### 3. Electron Type Declarations
**File**: `hive/src/renderer/electron.d.ts`

```typescript
export interface ElectronAPI {
  invoke: <T>(channel: string, ...args: unknown[]) => Promise<T>;
  on: (channel: string, callback: (...args: unknown[]) => void) => () => void;
}

declare global {
  interface Window {
    electronAPI: ElectronAPI;
  }
}

export {};
```

#### 4. React Entry Point
**File**: `hive/src/renderer/index.tsx`

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { App } from './App';
import { initializeTheme } from './lib/store';
import './index.css';

// Initialize theme before rendering
initializeTheme();

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

#### 5. TopBar Component
**File**: `hive/src/renderer/components/layout/TopBar.tsx`

```tsx
import React from 'react';
import { Plus, Settings, BarChart3, X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

interface Tab {
  id: string;
  title: string;
}

interface TopBarProps {
  tabs: Tab[];
  activeTab: string;
  onTabChange: (id: string) => void;
  onNewTab: () => void;
  onCloseTab: (id: string) => void;
  onSettings: () => void;
  onAnalytics: () => void;
}

export function TopBar({
  tabs,
  activeTab,
  onTabChange,
  onNewTab,
  onCloseTab,
  onSettings,
  onAnalytics,
}: TopBarProps) {
  return (
    <div className="h-12 flex items-center bg-[rgb(var(--sidebar))] border-b border-[rgb(var(--border))] draggable">
      {/* Spacer for traffic lights on macOS */}
      <div className="w-20 flex-shrink-0" />

      {/* Tabs */}
      <div className="flex-1 flex items-center gap-1 no-drag overflow-x-auto px-2">
        {tabs.map((tab) => (
          <button
            key={tab.id}
            onClick={() => onTabChange(tab.id)}
            className={cn(
              'flex items-center gap-2 px-3 py-1.5 text-sm rounded-t',
              'border border-b-0 border-[rgb(var(--border))] transition-colors',
              activeTab === tab.id
                ? 'bg-[rgb(var(--background))] text-[rgb(var(--foreground))]'
                : 'bg-transparent text-[rgb(var(--foreground-muted))] hover:bg-[rgb(var(--background))]/50'
            )}
          >
            <span className="truncate max-w-32">{tab.title}</span>
            {tabs.length > 1 && (
              <button
                onClick={(e) => {
                  e.stopPropagation();
                  onCloseTab(tab.id);
                }}
                className="hover:bg-[rgb(var(--destructive))]/20 rounded p-0.5"
              >
                <X className="h-3 w-3" />
              </button>
            )}
          </button>
        ))}

        <Button variant="ghost" size="icon" onClick={onNewTab} className="h-7 w-7 no-drag">
          <Plus className="h-4 w-4" />
        </Button>
      </div>

      {/* Actions */}
      <div className="flex items-center gap-1 px-2 no-drag">
        <Button variant="ghost" size="icon" className="h-8 w-8" onClick={onAnalytics}>
          <BarChart3 className="h-4 w-4" />
        </Button>
        <Button variant="ghost" size="icon" className="h-8 w-8" onClick={onSettings}>
          <Settings className="h-4 w-4" />
        </Button>
      </div>
    </div>
  );
}
```

#### 6. Sidebar Component
**File**: `hive/src/renderer/components/layout/Sidebar.tsx`

```tsx
import React from 'react';
import { ChevronLeft, ChevronRight, AlertCircle, Circle, XCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import type { Session } from '@shared/types';

interface SidebarProps {
  sessions: Session[];
  currentSessionId: string | null;
  onSessionSelect: (session: Session) => void;
  isCollapsed: boolean;
  onToggleCollapse: () => void;
}

const statusIcons = {
  idle: Circle,
  running: Circle,
  awaiting_input: AlertCircle,
  error: XCircle,
};

const statusColors = {
  idle: 'text-[rgb(var(--foreground-muted))]',
  running: 'text-[rgb(var(--success))] fill-[rgb(var(--success))]',
  awaiting_input: 'text-[rgb(var(--warning))]',
  error: 'text-[rgb(var(--destructive))]',
};

export function Sidebar({
  sessions,
  currentSessionId,
  onSessionSelect,
  isCollapsed,
  onToggleCollapse,
}: SidebarProps) {
  const groupedSessions = React.useMemo(() => {
    const groups = {
      awaiting: sessions.filter((s) => s.status === 'awaiting_input'),
      running: sessions.filter((s) => s.status === 'running'),
      completed: sessions.filter((s) => s.status === 'idle' || s.status === 'error'),
    };
    return groups;
  }, [sessions]);

  if (isCollapsed) {
    return (
      <div className="w-12 h-full bg-[rgb(var(--sidebar))] border-r border-[rgb(var(--border))] flex flex-col">
        <div className="flex-1" />
        <Button
          variant="ghost"
          size="icon"
          onClick={onToggleCollapse}
          className="m-2"
        >
          <ChevronRight className="h-4 w-4" />
        </Button>
      </div>
    );
  }

  return (
    <div className="w-full h-full bg-[rgb(var(--sidebar))] border-r border-[rgb(var(--border))] flex flex-col">
      <div className="p-3 border-b border-[rgb(var(--border))]">
        <h2 className="font-semibold text-sm">Sessions</h2>
      </div>

      <div className="flex-1 overflow-y-auto p-2 space-y-4">
        {groupedSessions.awaiting.length > 0 && (
          <SessionGroup
            title="NEEDS ACTION"
            sessions={groupedSessions.awaiting}
            currentSessionId={currentSessionId}
            onSessionSelect={onSessionSelect}
          />
        )}

        {groupedSessions.running.length > 0 && (
          <SessionGroup
            title="RUNNING"
            sessions={groupedSessions.running}
            currentSessionId={currentSessionId}
            onSessionSelect={onSessionSelect}
          />
        )}

        {groupedSessions.completed.length > 0 && (
          <SessionGroup
            title="COMPLETED"
            sessions={groupedSessions.completed}
            currentSessionId={currentSessionId}
            onSessionSelect={onSessionSelect}
          />
        )}

        {sessions.length === 0 && (
          <p className="text-sm text-[rgb(var(--foreground-muted))] text-center py-4">
            No sessions yet
          </p>
        )}
      </div>

      <div className="p-2 border-t border-[rgb(var(--border))]">
        <Button
          variant="ghost"
          size="sm"
          onClick={onToggleCollapse}
          className="w-full justify-start"
        >
          <ChevronLeft className="h-4 w-4 mr-2" />
          Collapse
        </Button>
      </div>
    </div>
  );
}

interface SessionGroupProps {
  title: string;
  sessions: Session[];
  currentSessionId: string | null;
  onSessionSelect: (session: Session) => void;
}

function SessionGroup({ title, sessions, currentSessionId, onSessionSelect }: SessionGroupProps) {
  return (
    <div>
      <h3 className="text-xs font-medium text-[rgb(var(--foreground-muted))] mb-1 px-2">
        {title}
      </h3>
      <div className="space-y-0.5">
        {sessions.map((session) => {
          const Icon = statusIcons[session.status];
          return (
            <button
              key={session.id}
              onClick={() => onSessionSelect(session)}
              className={cn(
                'w-full flex items-center gap-2 px-2 py-1.5 rounded text-sm text-left',
                'hover:bg-[rgb(var(--sidebar-accent))] transition-colors',
                currentSessionId === session.id && 'bg-[rgb(var(--sidebar-accent))]'
              )}
            >
              <Icon className={cn('h-3 w-3 flex-shrink-0', statusColors[session.status])} />
              <span className="truncate">{session.name}</span>
            </button>
          );
        })}
      </div>
    </div>
  );
}
```

#### 7. Main Layout Component
**File**: `hive/src/renderer/components/layout/MainLayout.tsx`

```tsx
import React from 'react';
import { Panel, PanelGroup, PanelResizeHandle } from 'react-resizable-panels';
import { TopBar } from './TopBar';
import { Sidebar } from './Sidebar';
import { useAppStore } from '@/lib/store';
import type { Session } from '@shared/types';

interface Tab {
  id: string;
  title: string;
  projectId: string | null;
}

interface MainLayoutProps {
  children: React.ReactNode;
}

export function MainLayout({ children }: MainLayoutProps) {
  const [tabs, setTabs] = React.useState<Tab[]>([
    { id: '1', title: 'Start', projectId: null },
  ]);
  const [activeTab, setActiveTab] = React.useState('1');
  const [sidebarCollapsed, setSidebarCollapsed] = React.useState(false);
  const [showSettings, setShowSettings] = React.useState(false);

  const { sessions, currentSession, setCurrentSession, currentProject } = useAppStore();

  const handleNewTab = () => {
    const newTab: Tab = {
      id: Date.now().toString(),
      title: 'Start',
      projectId: null,
    };
    setTabs([...tabs, newTab]);
    setActiveTab(newTab.id);
  };

  const handleCloseTab = (id: string) => {
    if (tabs.length === 1) return;
    const newTabs = tabs.filter((t) => t.id !== id);
    setTabs(newTabs);
    if (activeTab === id) {
      setActiveTab(newTabs[newTabs.length - 1].id);
    }
  };

  const handleSessionSelect = (session: Session) => {
    setCurrentSession(session);
  };

  return (
    <div className="h-screen w-screen flex flex-col overflow-hidden">
      <TopBar
        tabs={tabs}
        activeTab={activeTab}
        onTabChange={setActiveTab}
        onNewTab={handleNewTab}
        onCloseTab={handleCloseTab}
        onSettings={() => setShowSettings(true)}
        onAnalytics={() => {/* TODO */}}
      />

      <div className="flex-1 overflow-hidden">
        {currentProject ? (
          <PanelGroup direction="horizontal" autoSaveId="hive-main-layout">
            <Panel
              id="sidebar"
              defaultSize={20}
              minSize={10}
              maxSize={40}
              collapsible
              collapsedSize={3}
              onCollapse={() => setSidebarCollapsed(true)}
              onExpand={() => setSidebarCollapsed(false)}
            >
              <Sidebar
                sessions={sessions}
                currentSessionId={currentSession?.id ?? null}
                onSessionSelect={handleSessionSelect}
                isCollapsed={sidebarCollapsed}
                onToggleCollapse={() => setSidebarCollapsed(!sidebarCollapsed)}
              />
            </Panel>

            <PanelResizeHandle className="w-1 bg-[rgb(var(--border))] hover:bg-[rgb(var(--primary))] transition-colors" />

            <Panel id="content" minSize={50}>
              {children}
            </Panel>
          </PanelGroup>
        ) : (
          children
        )}
      </div>
    </div>
  );
}
```

#### 8. App Component
**File**: `hive/src/renderer/App.tsx`

```tsx
import React from 'react';
import { MainLayout } from '@/components/layout/MainLayout';
import { StartView } from '@/components/views/StartView';
import { ProjectView } from '@/components/views/ProjectView';
import { useAppStore } from '@/lib/store';

export function App() {
  const { currentProject } = useAppStore();

  return (
    <MainLayout>
      {currentProject ? <ProjectView /> : <StartView />}
    </MainLayout>
  );
}
```

### Success Criteria:

#### Automated Verification:
- [x] TypeScript compiles: `cd hive && pnpm exec tsc --noEmit`
- [x] App starts: `cd hive && pnpm start`

#### Manual Verification:
- [x] Window opens with correct macOS traffic light position
- [x] Top bar shows with tabs and buttons
- [x] Sidebar is visible (when a project is selected)
- [x] Panels are resizable
- [x] Layout persists after restart

**Implementation Note**: After completing this phase and all automated verification passes, pause here for manual confirmation before proceeding to Phase 6.

---

## Phase 6: Placeholder Views

### Overview
Create stub components for Start View, Project View, Settings, and Session View.

### Changes Required:

#### 1. Start View
**File**: `hive/src/renderer/components/views/StartView.tsx`

```tsx
import React from 'react';
import { FolderOpen, Plus } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';
import { useAppStore } from '@/lib/store';
import type { Project } from '@shared/types';

export function StartView() {
  const { projects, setProjects, setCurrentProject } = useAppStore();
  const [isLoading, setIsLoading] = React.useState(true);

  React.useEffect(() => {
    loadProjects();
  }, []);

  const loadProjects = async () => {
    try {
      const result = await window.electronAPI.invoke<Project[]>('db:projects:list');
      setProjects(result);
    } catch (error) {
      console.error('Failed to load projects:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleAddProject = async () => {
    const directory = await window.electronAPI.invoke<string | null>('dialog:open-directory');
    if (!directory) return;

    const name = directory.split('/').pop() || 'Unnamed Project';
    try {
      const project = await window.electronAPI.invoke<Project>('db:projects:create', {
        name,
        directory,
        settings: {},
      });
      setProjects([project, ...projects]);
    } catch (error) {
      console.error('Failed to create project:', error);
    }
  };

  const handleSelectProject = (project: Project) => {
    setCurrentProject(project);
  };

  if (isLoading) {
    return (
      <div className="h-full flex items-center justify-center">
        <p className="text-[rgb(var(--foreground-muted))]">Loading...</p>
      </div>
    );
  }

  return (
    <div className="h-full overflow-auto p-6">
      <div className="max-w-4xl mx-auto space-y-8">
        {/* Projects Section */}
        <section>
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-lg font-semibold flex items-center gap-2">
              <FolderOpen className="h-5 w-5" />
              Your Projects
            </h2>
            <Button onClick={handleAddProject} size="sm">
              <Plus className="h-4 w-4 mr-2" />
              Add Project
            </Button>
          </div>

          {projects.length === 0 ? (
            <Card>
              <CardContent className="py-8 text-center">
                <p className="text-[rgb(var(--foreground-muted))] mb-4">
                  No projects yet. Add a project to get started.
                </p>
                <Button onClick={handleAddProject}>
                  <Plus className="h-4 w-4 mr-2" />
                  Add Your First Project
                </Button>
              </CardContent>
            </Card>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {projects.map((project) => (
                <Card
                  key={project.id}
                  className="cursor-pointer hover:border-[rgb(var(--primary))] transition-colors"
                  onClick={() => handleSelectProject(project)}
                >
                  <CardHeader>
                    <CardTitle className="text-base">{project.name}</CardTitle>
                    <CardDescription className="truncate">
                      {project.directory}
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <p className="text-sm text-[rgb(var(--foreground-muted))]">
                      0 sessions
                    </p>
                  </CardContent>
                </Card>
              ))}
            </div>
          )}
        </section>
      </div>
    </div>
  );
}
```

#### 2. Project View
**File**: `hive/src/renderer/components/views/ProjectView.tsx`

```tsx
import React from 'react';
import { ArrowLeft, Plus } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { useAppStore } from '@/lib/store';
import { SessionView } from './SessionView';
import type { Session } from '@shared/types';

export function ProjectView() {
  const { currentProject, setCurrentProject, sessions, setSessions, currentSession, setCurrentSession } = useAppStore();

  React.useEffect(() => {
    if (currentProject) {
      loadSessions();
    }
  }, [currentProject?.id]);

  const loadSessions = async () => {
    if (!currentProject) return;
    try {
      const result = await window.electronAPI.invoke<Session[]>('db:sessions:list', {
        projectId: currentProject.id,
      });
      setSessions(result);
    } catch (error) {
      console.error('Failed to load sessions:', error);
    }
  };

  const handleBack = () => {
    setCurrentProject(null);
    setCurrentSession(null);
    setSessions([]);
  };

  const handleNewSession = async () => {
    if (!currentProject) return;

    // Create a placeholder session
    try {
      const session = await window.electronAPI.invoke<Session>('db:sessions:create', {
        projectId: currentProject.id,
        claudeSessionId: null,
        name: `Session ${sessions.length + 1}`,
        actionType: 'freeform',
        status: 'idle',
        metadata: {},
      });
      setSessions([session, ...sessions]);
      setCurrentSession(session);
    } catch (error) {
      console.error('Failed to create session:', error);
    }
  };

  if (!currentProject) {
    return null;
  }

  return (
    <div className="h-full flex flex-col">
      {/* Header */}
      <div className="h-12 flex items-center gap-2 px-4 border-b border-[rgb(var(--border))] bg-[rgb(var(--background-secondary))]">
        <Button variant="ghost" size="sm" onClick={handleBack}>
          <ArrowLeft className="h-4 w-4 mr-2" />
          Back
        </Button>
        <span className="font-medium">{currentProject.name}</span>
        <div className="flex-1" />
        <Button size="sm" onClick={handleNewSession}>
          <Plus className="h-4 w-4 mr-2" />
          New Session
        </Button>
      </div>

      {/* Content */}
      <div className="flex-1 overflow-hidden">
        {currentSession ? (
          <SessionView session={currentSession} />
        ) : (
          <div className="h-full flex flex-col items-center justify-center">
            <p className="text-[rgb(var(--foreground-muted))] mb-4">
              Select a session or create a new one
            </p>
            <Button onClick={handleNewSession}>
              <Plus className="h-4 w-4 mr-2" />
              New Session
            </Button>
          </div>
        )}
      </div>
    </div>
  );
}
```

#### 3. Session View (Placeholder)
**File**: `hive/src/renderer/components/views/SessionView.tsx`

```tsx
import React from 'react';
import { cn } from '@/lib/utils';
import type { Session } from '@shared/types';

interface SessionViewProps {
  session: Session;
}

type TabId = 'agent' | 'diff' | 'analytics' | 'thoughts';

export function SessionView({ session }: SessionViewProps) {
  const [activeTab, setActiveTab] = React.useState<TabId>('agent');

  const tabs: { id: TabId; label: string }[] = [
    { id: 'agent', label: 'Agent' },
    { id: 'diff', label: 'Diff' },
    { id: 'analytics', label: 'Analytics' },
    { id: 'thoughts', label: 'Thoughts' },
  ];

  return (
    <div className="h-full flex flex-col">
      {/* Tab Bar */}
      <div className="flex items-center border-b border-[rgb(var(--border))] bg-[rgb(var(--background-secondary))]">
        {tabs.map((tab) => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            className={cn(
              'px-4 py-2 text-sm font-medium border-b-2 transition-colors',
              activeTab === tab.id
                ? 'border-[rgb(var(--primary))] text-[rgb(var(--foreground))]'
                : 'border-transparent text-[rgb(var(--foreground-muted))] hover:text-[rgb(var(--foreground))]'
            )}
          >
            {tab.label}
          </button>
        ))}
      </div>

      {/* Session Header */}
      <div className="px-4 py-2 border-b border-[rgb(var(--border))]">
        <div className="flex items-center gap-2">
          <span className="font-medium">{session.name}</span>
          <span className="text-xs px-2 py-0.5 rounded bg-[rgb(var(--secondary))] text-[rgb(var(--secondary-foreground))]">
            {session.actionType}
          </span>
          <span className={cn(
            'text-xs px-2 py-0.5 rounded',
            session.status === 'running' && 'bg-[rgb(var(--success))]/20 text-[rgb(var(--success))]',
            session.status === 'awaiting_input' && 'bg-[rgb(var(--warning))]/20 text-[rgb(var(--warning))]',
            session.status === 'error' && 'bg-[rgb(var(--destructive))]/20 text-[rgb(var(--destructive))]',
            session.status === 'idle' && 'bg-[rgb(var(--secondary))] text-[rgb(var(--secondary-foreground))]'
          )}>
            {session.status}
          </span>
        </div>
      </div>

      {/* Tab Content */}
      <div className="flex-1 overflow-hidden">
        {activeTab === 'agent' && <AgentTabPlaceholder />}
        {activeTab === 'diff' && <PlaceholderTab title="Diff" />}
        {activeTab === 'analytics' && <PlaceholderTab title="Analytics" />}
        {activeTab === 'thoughts' && <PlaceholderTab title="Thoughts" />}
      </div>
    </div>
  );
}

function AgentTabPlaceholder() {
  return (
    <div className="h-full flex flex-col">
      {/* Messages area */}
      <div className="flex-1 overflow-auto p-4">
        <div className="text-center text-[rgb(var(--foreground-muted))] py-8">
          <p className="mb-2">Claude SDK integration placeholder</p>
          <p className="text-sm">Messages will appear here</p>
        </div>
      </div>

      {/* Input area */}
      <div className="p-4 border-t border-[rgb(var(--border))]">
        <div className="flex gap-2">
          <input
            type="text"
            placeholder="Type a message... (placeholder)"
            disabled
            className="flex-1 px-3 py-2 rounded border border-[rgb(var(--border))] bg-[rgb(var(--background))] text-[rgb(var(--foreground))] placeholder:text-[rgb(var(--foreground-muted))] disabled:opacity-50"
          />
          <button
            disabled
            className="px-4 py-2 rounded bg-[rgb(var(--primary))] text-[rgb(var(--primary-foreground))] disabled:opacity-50"
          >
            Send
          </button>
        </div>
      </div>
    </div>
  );
}

function PlaceholderTab({ title }: { title: string }) {
  return (
    <div className="h-full flex items-center justify-center">
      <p className="text-[rgb(var(--foreground-muted))]">
        {title} tab - Coming soon
      </p>
    </div>
  );
}
```

#### 4. Settings Modal (Basic)
**File**: `hive/src/renderer/components/views/SettingsModal.tsx`

```tsx
import React from 'react';
import { X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { useThemeStore } from '@/lib/store';

interface SettingsModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export function SettingsModal({ isOpen, onClose }: SettingsModalProps) {
  const { theme, setTheme } = useThemeStore();

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      {/* Backdrop */}
      <div
        className="absolute inset-0 bg-black/50"
        onClick={onClose}
      />

      {/* Modal */}
      <div className="relative w-full max-w-lg bg-[rgb(var(--background))] rounded-lg shadow-xl border border-[rgb(var(--border))]">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[rgb(var(--border))]">
          <h2 className="text-lg font-semibold">Settings</h2>
          <Button variant="ghost" size="icon" onClick={onClose}>
            <X className="h-4 w-4" />
          </Button>
        </div>

        {/* Content */}
        <div className="p-4 space-y-6">
          {/* Theme */}
          <div>
            <h3 className="text-sm font-medium mb-3">Theme</h3>
            <div className="flex gap-2">
              {(['light', 'dark', 'system'] as const).map((t) => (
                <button
                  key={t}
                  onClick={() => setTheme(t)}
                  className={`px-4 py-2 rounded border transition-colors ${
                    theme === t
                      ? 'border-[rgb(var(--primary))] bg-[rgb(var(--primary))]/10'
                      : 'border-[rgb(var(--border))] hover:border-[rgb(var(--foreground-muted))]'
                  }`}
                >
                  {t.charAt(0).toUpperCase() + t.slice(1)}
                </button>
              ))}
            </div>
          </div>

          {/* Placeholder sections */}
          <div>
            <h3 className="text-sm font-medium mb-3">Credentials</h3>
            <p className="text-sm text-[rgb(var(--foreground-muted))]">
              Credential configuration coming soon
            </p>
          </div>

          <div>
            <h3 className="text-sm font-medium mb-3">Storage</h3>
            <p className="text-sm text-[rgb(var(--foreground-muted))]">
              ~/.hive/
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
```

#### 5. Update App to Include Settings Modal
**File**: `hive/src/renderer/App.tsx` (update)

```tsx
import React from 'react';
import { MainLayout } from '@/components/layout/MainLayout';
import { StartView } from '@/components/views/StartView';
import { ProjectView } from '@/components/views/ProjectView';
import { SettingsModal } from '@/components/views/SettingsModal';
import { useAppStore } from '@/lib/store';

export function App() {
  const { currentProject } = useAppStore();
  const [showSettings, setShowSettings] = React.useState(false);

  // Expose settings toggle to MainLayout via context or props
  // For simplicity, using a global event
  React.useEffect(() => {
    const handler = () => setShowSettings(true);
    window.addEventListener('open-settings', handler);
    return () => window.removeEventListener('open-settings', handler);
  }, []);

  return (
    <>
      <MainLayout>
        {currentProject ? <ProjectView /> : <StartView />}
      </MainLayout>
      <SettingsModal isOpen={showSettings} onClose={() => setShowSettings(false)} />
    </>
  );
}
```

#### 6. Update MainLayout to Dispatch Settings Event
**File**: `hive/src/renderer/components/layout/MainLayout.tsx` (update the onSettings handler)

Change `onSettings={() => setShowSettings(true)}` to:

```tsx
onSettings={() => window.dispatchEvent(new Event('open-settings'))}
```

### Success Criteria:

#### Automated Verification:
- [x] TypeScript compiles: `cd hive && pnpm exec tsc --noEmit`
- [x] App starts without errors: `cd hive && pnpm start`

#### Manual Verification:
- [x] Start View shows "Your Projects" with Add button
- [x] Clicking Add Project opens native directory picker
- [x] Added project appears as a card
- [x] Clicking project card navigates to Project View
- [x] Project View shows sidebar with sessions
- [x] "New Session" creates a placeholder session
- [x] Session View shows tabs (Agent, Diff, Analytics, Thoughts)
- [x] Agent tab shows placeholder message area
- [x] Settings modal opens via gear icon
- [x] Theme toggle switches between Light/Dark/System
- [x] Dark theme applies Solarized Dark colors
- [x] All state persists after app restart

**Implementation Note**: This is the final phase. After completing all verification, the foundation is ready for Claude SDK integration and Thoughts pane implementation in future phases.

---

## Post-Phase 6: Bug Fixes & Enhancements

### Issues Found & Fixed

#### 1. Preload Script Not Building
**Problem**: Both main and preload entries were named `index.ts`, causing only main to output.
**Fix**: Renamed `src/preload/index.ts` → `src/preload/preload.ts` and updated `forge.config.ts`.

#### 2. Nested Button HTML Error
**Problem**: Tab close button was inside tab button element - invalid HTML.
**Fix**: Changed tab wrapper from `<button>` to `<div role="button">`.

#### 3. Tailwind v4 Syntax
**Problem**: Plan used Tailwind v3 syntax (`rgb(var(--xxx))`), but v4 uses hex colors in `@theme`.
**Fix**: Updated CSS to use `@import "tailwindcss"` and `@theme` blocks, changed all `rgb(var(--xxx))` to `var(--xxx)`.

#### 4. electron-store ESM Issue
**Problem**: `Store is not a constructor` error with ESM modules.
**Fix**: Added ESM default export handling: `const Store = (ElectronStore as unknown as { default: typeof ElectronStore }).default || ElectronStore;`

#### 5. Sidebar Collapse Not Working
**Problem**: Clicking collapse only toggled visual state, didn't actually collapse the panel.
**Fix**: Added `sidebarPanelRef` with `ImperativePanelHandle` to call `panel.collapse()`/`panel.expand()`.

#### 6. Window Not Draggable/Resizable
**Problem**: CSS classes for `-webkit-app-region` weren't applying correctly.
**Fix**: Used inline styles `style={{ WebkitAppRegion: 'drag' }}` and added draggable spacer between tabs and action buttons.

#### 7. Tabs Not Independent
**Problem**: All tabs shared global `currentProject`/`currentSession` state.
**Fix**: Created `TabContext` with per-tab state (`tabStates` object), each tab has isolated `project`, `session`, `sessions`.

#### 8. Tab Names Not Updating
**Problem**: Tab titles stayed as "Start" when navigating.
**Fix**: Added effect to update tab title when project changes.

#### 9. Tabs Not Persisting
**Problem**: Tabs used localStorage which persists to app data, not `~/.hive/`.
**Fix**: Added IPC handlers `tabs:get`/`tabs:set` using electron-store at `~/.hive/ui-state.json`.

#### 10. Tab Renaming Not Supported
**Problem**: Users couldn't rename tabs.
**Fix**: Added double-click to edit tab name, Enter to save, Escape to cancel.

### Additional Manual Verification:
- [x] Window can be moved by dragging the top bar (spacer area)
- [x] Window can be resized from edges
- [x] Tabs are fully independent (different projects/sessions per tab)
- [x] Tab names can be edited by double-clicking
- [x] Tabs persist to `~/.hive/ui-state.json` across restarts
- [x] Multiple tabs can view the same project with different sessions

---

## Learnings & Notes

### Technical Learnings

1. **Electron Forge Vite Plugin**: Entry filenames must be unique across main/preload builds - both named `index.ts` causes conflicts.

2. **Tailwind v4**: Major syntax changes from v3:
   - Use `@import "tailwindcss"` instead of `@tailwind base/components/utilities`
   - Use `@theme` block for custom properties instead of `theme.extend`
   - Colors are hex values in `@theme`, use `var(--xxx)` directly (no `rgb()`)
   - Requires `@tailwindcss/vite` plugin

3. **electron-store ESM**: The package has ESM/CJS interop issues. Need to handle default export: `Store.default || Store`.

4. **Window Dragging**: CSS class-based `-webkit-app-region` can be unreliable. Inline styles work more consistently.

5. **React Resizable Panels**: Use `ImperativePanelHandle` ref for programmatic collapse/expand, not just state-driven.

### Architecture Decisions

1. **Tab State**: Each tab manages its own isolated state via `TabContext`. This allows:
   - Same project in multiple tabs with different sessions
   - Independent navigation per tab
   - Proper state restoration on tab switch

2. **Storage Split**:
   - `~/.hive/preferences.json` - User preferences (theme, defaults)
   - `~/.hive/ui-state.json` - UI state (tabs, window layout)
   - `~/.hive/hive.db` - Application data (projects, sessions)

3. **Global Store Removal**: `useAppStore` is now only used for theme. All project/session state moved to `TabContext`.

---

## Next Steps (Future Phases)

### Phase 7: Claude SDK Integration ✅
**See detailed plan**: [`2025-12-15-hive-v0.2-claude-sdk-integration.md`](./2025-12-15-hive-v0.2-claude-sdk-integration.md)

- [x] Install `@anthropic-ai/claude-agent-sdk` package
- [x] Create SessionManager class wrapping SDK
- [x] Add IPC handlers for session operations
- [x] Build permission dialog component
- [x] Replace placeholder Agent tab with working UI
- [x] Add API key configuration to Settings

**Additional improvements implemented:**
- [x] Interrupt-and-resume permission flow with hash-based pre-approval
- [x] UI polish & session management (editable names, status icons, tooltips)
- [x] Settings & shell integration (editor/terminal selection, continue in terminal)
- [x] Keyboard shortcuts (⌘1-9 tabs, ⌘W close, ⌘T new tab, ⌘N new session)
- [x] Activity indicators (connecting, thinking, streaming, tool_use)
- [x] Markdown rendering for messages
- [x] Draft persistence across tab switches
- [x] External prompt file editing (Ctrl+G)

### Phase 8: Thoughts Pane ✅
**See detailed plan**: [`2025-12-15-hive-phase-8-thoughts-pane.md`](./2025-12-15-hive-phase-8-thoughts-pane.md)

- [x] File tree component for `{project}/thoughts/` directory
- [x] Monaco editor with Solarized themes for markdown editing
- [x] Real-time file watching with chokidar
- [x] Hive-comment system (`<!-- hive-comment(id): content -->`)
- [x] Send comments to Claude functionality

**Additional improvements implemented:**
- [x] Fuse.js fuzzy file search in file tree

### Phase 9: Diff Tab ✅
**See detailed plan**: [`2025-12-15-hive-phase-9-diff-tab.md`](./2025-12-15-hive-phase-9-diff-tab.md)

- [x] Git diff integration via simple-git
- [x] Side-by-side Monaco DiffEditor
- [x] File change tracking per session (since session start time)
- [x] File status icons (added/modified/deleted/renamed)

**Additional improvements implemented:**
- [x] Expand/collapse unchanged lines toggle
- [x] Diff stats (+/-) shown in tab label
- [x] Fuse.js fuzzy file search
- [x] Keyboard navigation (j/k, arrow keys)
- [x] Open file in external editor
- [x] Binary file detection

### Phase 10: Analytics (In Progress)
**See detailed plan**: [`2025-12-15-hive-phase-10-analytics-persist-results.md`](./2025-12-15-hive-phase-10-analytics-persist-results.md)

- [x] Persist result messages with cost/duration/usage data to SQLite
- [x] Merge persisted results when restoring session history
- [ ] Token usage tracking UI
- [ ] Session duration metrics display
- [ ] Cost estimation dashboard
- [ ] Aggregated analytics view (sum costs across sessions/projects)

### Future Improvements
- [x] Keyboard shortcuts (vim bindings per research)
- [x] Native notifications
- [x] System tray support
- [ ] Remote access via localtunnel
- [ ] Multi-window support

---

## Testing Strategy

### Unit Tests (Deferred)
Unit testing setup will be added in a future phase. For v0.1, manual verification is sufficient.

### Integration Tests (Deferred)
Integration tests for IPC channels and database operations will be added later.

### Manual Testing Steps

1. **Fresh Install Test**:
   - Delete `~/.hive/` directory
   - Run `pnpm start`
   - Verify database and preferences files are created
   - Add a project, create a session
   - Restart app, verify data persists

2. **Theme Test**:
   - Toggle through all theme options
   - Verify correct colors apply
   - Close and reopen app, verify theme persists

3. **Layout Test**:
   - Resize sidebar panel
   - Collapse/expand sidebar
   - Restart app, verify layout persists

4. **Project/Session Flow**:
   - Add multiple projects
   - Switch between projects
   - Create sessions in different projects
   - Delete a project (verify sessions are removed)

---

## Performance Considerations

- SQLite with WAL mode for multi-window support (future)
- Prepared statements for database queries
- React.memo for expensive components (to be added as needed)
- Panel layout persistence via react-resizable-panels autoSaveId

---

## References

### Successor Plans:
- [`2025-12-15-hive-v0.2-claude-sdk-integration.md`](./2025-12-15-hive-v0.2-claude-sdk-integration.md) - Claude Agent SDK integration (Phase 7)
- [`2025-12-15-hive-phase-8-thoughts-pane.md`](./2025-12-15-hive-phase-8-thoughts-pane.md) - Thoughts Pane implementation (Phase 8)
- [`2025-12-15-hive-phase-9-diff-tab.md`](./2025-12-15-hive-phase-9-diff-tab.md) - Diff Tab implementation (Phase 9)

### Related Research:
- `thoughts/shared/research/2025-12-15-hive-electron-app-research.md`
- `thoughts/shared/research/2025-12-15-hive-electron-forge-setup.md`
- `thoughts/shared/research/2025-12-15-hive-claude-sdk-integration.md`
- `thoughts/shared/research/2025-12-15-hive-storage-and-remote-access.md`
- `thoughts/shared/research/2025-12-15-hive-ux-ui-design-spec.md`

### External Resources:
- [Electron Forge Documentation](https://www.electronforge.io/)
- [better-sqlite3](https://github.com/WiseLibs/better-sqlite3)
- [electron-store](https://github.com/sindresorhus/electron-store)
- [react-resizable-panels](https://github.com/bvaughn/react-resizable-panels)
- [shadcn/ui](https://ui.shadcn.com/)
- [Solarized Colors](https://ethanschoonover.com/solarized/)
